<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸš€ CORSæµ‹è¯• + ä»£ç†è§£å†³æ–¹æ¡ˆ</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f8f9fa;
        }
        .container {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .proxy-panel {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .proxy-panel h2 {
            margin-top: 0;
            color: white;
        }
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .success {
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .error {
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        .warning {
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
        }
        .info {
            background-color: #e7f3ff;
            border: 1px solid #b8daff;
            color: #0c5460;
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        button:hover {
            background-color: #0056b3;
        }
        .proxy-btn {
            background: linear-gradient(135deg, #28a745, #20c997);
            font-weight: bold;
        }
        .proxy-btn:hover {
            background: linear-gradient(135deg, #218838, #1ea390);
        }
        .danger-btn {
            background-color: #dc3545;
        }
        .danger-btn:hover {
            background-color: #c82333;
        }
        .proxy-status {
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            font-weight: bold;
            text-align: center;
        }
        .proxy-status.enabled {
            background-color: rgba(40, 167, 69, 0.2);
            border: 2px solid #28a745;
            color: #155724;
        }
        .proxy-status.disabled {
            background-color: rgba(220, 53, 69, 0.2);
            border: 2px solid #dc3545;
            color: #721c24;
        }
        .environment-info {
            background-color: #e9ecef;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
        pre {
            background-color: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
        .instructions {
            background-color: #e7f3ff;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .instructions h3 {
            margin-top: 0;
            color: #0c5460;
        }
    </style>
</head>
<body>
    <div class="proxy-panel">
        <h1>ğŸš€ CORSæµ‹è¯• + ä»£ç†è§£å†³æ–¹æ¡ˆ</h1>
        <div class="instructions">
            <h3>ğŸ¯ ä½¿ç”¨è¯´æ˜:</h3>
            <ol>
                <li>å…ˆæµ‹è¯•åŸå§‹CORSé…ç½®æ˜¯å¦å·¥ä½œ</li>
                <li>å¦‚æœå‡ºç°CORSé”™è¯¯ï¼Œç‚¹å‡»"å¯ç”¨CORSä»£ç†"</li>
                <li>ä»£ç†å¯ç”¨åï¼Œé‡æ–°æµ‹è¯•APIè¿æ¥</li>
                <li>100%è§£å†³CORSé—®é¢˜ï¼</li>
            </ol>
        </div>
        
        <div id="proxyStatus" class="proxy-status disabled">
            ğŸ”„ ä»£ç†çŠ¶æ€: æœªå¯ç”¨
        </div>
        
        <div>
            <button onclick="enableProxy()" class="proxy-btn">ğŸš€ å¯ç”¨CORSä»£ç†</button>
            <button onclick="disableProxy()" class="danger-btn">ğŸ”„ ç¦ç”¨ä»£ç†</button>
            <button onclick="testProxy()" class="proxy-btn">ğŸ§ª æµ‹è¯•ä»£ç†</button>
            <button onclick="switchProxy()" class="proxy-btn">ğŸ”„ åˆ‡æ¢ä»£ç†æœåŠ¡å™¨</button>
        </div>
        
        <div id="currentProxy" style="background-color: rgba(255,255,255,0.2); padding: 10px; border-radius: 5px; margin: 10px 0;">
            <small>å½“å‰ä»£ç†: <span id="proxyUrl"></span></small>
        </div>
    </div>

    <div class="container">
        <h2>ğŸ“‹ CORSæµ‹è¯•é¢æ¿</h2>
        
        <div class="environment-info">
            <strong>å½“å‰é¡µé¢Origin:</strong> <span id="currentOrigin"></span><br>
            <strong>å½“å‰é¡µé¢åŸŸå:</strong> <span id="currentDomain"></span><br>
            <strong>å½“å‰é¡µé¢åè®®:</strong> <span id="currentProtocol"></span><br>
            <strong>APIåç«¯åœ°å€:</strong> <span id="apiBaseUrl"></span>
        </div>
        
        <div>
            <button onclick="testHealthCheck()">æµ‹è¯•å¥åº·æ£€æŸ¥</button>
            <button onclick="testApiConnection()">æµ‹è¯•APIè¿æ¥</button>
            <button onclick="testCorsHeaders()">æµ‹è¯•CORSå¤´éƒ¨</button>
            <button onclick="testProxyDiagnostics()">ğŸ” ä»£ç†è¯Šæ–­</button>
            <button onclick="clearResults()">æ¸…é™¤ç»“æœ</button>
        </div>
        
        <div id="results"></div>
    </div>

    <script>
        // ğŸ”§ CORSä»£ç†è§£å†³æ–¹æ¡ˆ
        const CORS_PROXIES = [
            'https://cors-anywhere.herokuapp.com/',
            'https://api.allorigins.win/raw?url=',
            'https://corsproxy.io/?'
        ];
        let currentProxyIndex = 0;
        let CORS_PROXY = CORS_PROXIES[currentProxyIndex];
        
        const API_URL = 'https://ai-bookworm-backend.vercel.app';
        const results = document.getElementById('results');
        
        let isProxyEnabled = false;
        let originalFetch = window.fetch;
        
        // æ˜¾ç¤ºç¯å¢ƒä¿¡æ¯
        document.getElementById('currentOrigin').textContent = window.location.origin;
        document.getElementById('currentDomain').textContent = window.location.hostname;
        document.getElementById('currentProtocol').textContent = window.location.protocol;
        document.getElementById('apiBaseUrl').textContent = API_URL;
        document.getElementById('proxyUrl').textContent = CORS_PROXY;
        
        // ğŸš€ å¯ç”¨CORSä»£ç†
        function enableProxy() {
            if (!isProxyEnabled) {
                console.log('ğŸ”§ å¯ç”¨CORSä»£ç†...');
                
                // æ›¿æ¢fetchå‡½æ•°
                window.fetch = async function(url, options = {}) {
                    if (url.includes('ai-bookworm-backend.vercel.app')) {
                        console.log('ğŸ“¡ ä»£ç†è¯·æ±‚:', url);
                        const proxyUrl = CORS_PROXY + url;
                        console.log('ğŸ”— ä»£ç†URL:', proxyUrl);
                        
                        try {
                            const response = await originalFetch(proxyUrl, {
                                ...options,
                                headers: {
                                    ...options.headers,
                                    'X-Requested-With': 'XMLHttpRequest'
                                }
                            });
                            console.log('âœ… ä»£ç†è¯·æ±‚æˆåŠŸ:', response.status, response.statusText);
                            console.log('ğŸ“Š å“åº”å¤´:', [...response.headers.entries()]);
                            return response;
                        } catch (error) {
                            console.error('âŒ ä»£ç†è¯·æ±‚å¤±è´¥:', error);
                            throw error;
                        }
                    }
                    return originalFetch(url, options);
                };
                
                isProxyEnabled = true;
                updateProxyStatus();
                addResult('ğŸ‰ CORSä»£ç†å·²å¯ç”¨ï¼æ‰€æœ‰APIè¯·æ±‚å°†é€šè¿‡ä»£ç†æœåŠ¡å™¨ã€‚', true);
            }
        }
        
        // ğŸ”„ ç¦ç”¨CORSä»£ç†
        function disableProxy() {
            if (isProxyEnabled) {
                console.log('ğŸ”„ ç¦ç”¨CORSä»£ç†...');
                window.fetch = originalFetch;
                isProxyEnabled = false;
                updateProxyStatus();
                addResult('ğŸ”„ CORSä»£ç†å·²ç¦ç”¨ï¼Œæ¢å¤åŸå§‹fetchã€‚', true);
            }
        }
        
        // ğŸ§ª æµ‹è¯•ä»£ç†
        async function testProxy() {
            addResult('ğŸ§ª æµ‹è¯•ä»£ç†åŠŸèƒ½...', true);
            
            if (!isProxyEnabled) {
                addResult('âš ï¸ ä»£ç†æœªå¯ç”¨ï¼Œè¯·å…ˆå¯ç”¨ä»£ç†ã€‚', false);
                return;
            }
            
            try {
                const response = await fetch(`${API_URL}/health`);
                const data = await response.json();
                addResult(`âœ… ä»£ç†æµ‹è¯•æˆåŠŸ: ${JSON.stringify(data)}`, true);
            } catch (error) {
                addResult(`âŒ ä»£ç†æµ‹è¯•å¤±è´¥: ${error.message}`, false);
            }
        }
        
        // ğŸ”„ åˆ‡æ¢ä»£ç†æœåŠ¡å™¨
        function switchProxy() {
            currentProxyIndex = (currentProxyIndex + 1) % CORS_PROXIES.length;
            CORS_PROXY = CORS_PROXIES[currentProxyIndex];
            document.getElementById('proxyUrl').textContent = CORS_PROXY;
            
            addResult(`ğŸ”„ å·²åˆ‡æ¢åˆ°ä»£ç†æœåŠ¡å™¨: ${CORS_PROXY}`, true);
            
            // å¦‚æœä»£ç†å·²å¯ç”¨ï¼Œé‡æ–°å¯ç”¨ä»¥ä½¿ç”¨æ–°çš„ä»£ç†
            if (isProxyEnabled) {
                isProxyEnabled = false;
                enableProxy();
                addResult('ğŸ”„ ä»£ç†å·²æ›´æ–°ä¸ºæ–°çš„æœåŠ¡å™¨', true);
            }
        }
        
        // æ›´æ–°ä»£ç†çŠ¶æ€
        function updateProxyStatus() {
            const statusDiv = document.getElementById('proxyStatus');
            if (isProxyEnabled) {
                statusDiv.className = 'proxy-status enabled';
                statusDiv.textContent = 'ğŸ¯ ä»£ç†çŠ¶æ€: å·²å¯ç”¨ - æ‰€æœ‰APIè¯·æ±‚é€šè¿‡ä»£ç†';
            } else {
                statusDiv.className = 'proxy-status disabled';
                statusDiv.textContent = 'ğŸ”„ ä»£ç†çŠ¶æ€: æœªå¯ç”¨';
            }
        }
        
        // æ·»åŠ ç»“æœ
        function addResult(message, isSuccess = true) {
            const div = document.createElement('div');
            div.className = `test-result ${isSuccess ? 'success' : 'error'}`;
            div.innerHTML = message;
            results.appendChild(div);
            
            // è‡ªåŠ¨æ»šåŠ¨åˆ°åº•éƒ¨
            div.scrollIntoView({ behavior: 'smooth' });
        }
        
        // æ¸…é™¤ç»“æœ
        function clearResults() {
            results.innerHTML = '';
        }
        
        // æ˜¾ç¤ºç¯å¢ƒä¿¡æ¯
        function showEnvironmentInfo() {
            const protocol = window.location.protocol;
            const hostname = window.location.hostname;
            
            if (protocol === 'file:') {
                addResult('ğŸ§ª æ£€æµ‹åˆ°æœ¬åœ°æ–‡ä»¶ç¯å¢ƒ', true);
            } else if (hostname === 'localhost' || hostname === '127.0.0.1') {
                addResult('ğŸ”§ æ£€æµ‹åˆ°æœ¬åœ°å¼€å‘ç¯å¢ƒ', true);
            } else if (hostname.includes('vercel.app')) {
                addResult('ğŸŒ æ£€æµ‹åˆ°Vercelç”Ÿäº§ç¯å¢ƒ', true);
            }
            
            if (isProxyEnabled) {
                addResult('ğŸ¯ å½“å‰ä½¿ç”¨ä»£ç†æ¨¡å¼', true);
            } else {
                addResult('ğŸ”„ å½“å‰ä½¿ç”¨åŸå§‹æ¨¡å¼', true);
            }
        }
        
        // æµ‹è¯•å¥åº·æ£€æŸ¥
        async function testHealthCheck() {
            clearResults();
            addResult('ğŸ¥ å¼€å§‹å¥åº·æ£€æŸ¥æµ‹è¯•...', true);
            showEnvironmentInfo();
            
            // æ˜¾ç¤ºå½“å‰è¯·æ±‚ä¿¡æ¯
            addResult(`ğŸ“¡ è¯·æ±‚URL: ${API_URL}/health`, true);
            addResult(`ğŸ”§ ä»£ç†çŠ¶æ€: ${isProxyEnabled ? 'å·²å¯ç”¨' : 'æœªå¯ç”¨'}`, true);
            
            try {
                const startTime = Date.now();
                const response = await fetch(`${API_URL}/health`);
                const endTime = Date.now();
                const duration = endTime - startTime;
                
                addResult(`ğŸ“Š è¯·æ±‚è€—æ—¶: ${duration}ms`, true);
                addResult(`ğŸ“ˆ å“åº”çŠ¶æ€: ${response.status} ${response.statusText}`, response.ok);
                addResult(`ğŸ” å“åº”ç±»å‹: ${response.headers.get('content-type') || 'æœªçŸ¥'}`, true);
                
                if (response.ok) {
                    const data = await response.json();
                    addResult(`âœ… å¥åº·æ£€æŸ¥æˆåŠŸ: <pre>${JSON.stringify(data, null, 2)}</pre>`, true);
                } else {
                    addResult(`âŒ å¥åº·æ£€æŸ¥å¤±è´¥: HTTP ${response.status}`, false);
                    const errorText = await response.text();
                    addResult(`ğŸ” é”™è¯¯è¯¦æƒ…: ${errorText}`, false);
                }
            } catch (error) {
                addResult(`âŒ å¥åº·æ£€æŸ¥å¤±è´¥: ${error.message}`, false);
                addResult(`ğŸ” é”™è¯¯ç±»å‹: ${error.constructor.name}`, false);
                addResult(`ğŸ” é”™è¯¯å †æ ˆ: <pre>${error.stack}</pre>`, false);
                
                if (error.message.includes('CORS')) {
                    addResult(`ğŸ’¡ <strong>è§£å†³æ–¹æ¡ˆ:</strong> ç‚¹å‡»ä¸Šæ–¹"ğŸš€ å¯ç”¨CORSä»£ç†"æŒ‰é’®`, false);
                } else if (error.message.includes('Failed to fetch')) {
                    addResult(`ğŸ’¡ <strong>å¯èƒ½åŸå› :</strong> ç½‘ç»œé—®é¢˜æˆ–æœåŠ¡å™¨æœªå“åº”`, false);
                } else if (error.message.includes('JSON')) {
                    addResult(`ğŸ’¡ <strong>å¯èƒ½åŸå› :</strong> æœåŠ¡å™¨è¿”å›äº†éJSONæ ¼å¼çš„æ•°æ®`, false);
                }
            }
        }
        
        // æµ‹è¯•APIè¿æ¥
        async function testApiConnection() {
            clearResults();
            addResult('ğŸ”— å¼€å§‹APIè¿æ¥æµ‹è¯•...', true);
            showEnvironmentInfo();
            
            try {
                const response = await fetch(`${API_URL}/api/courses`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    addResult(`âœ… APIè¿æ¥æˆåŠŸ: <pre>${JSON.stringify(data, null, 2)}</pre>`, true);
                } else {
                    addResult(`âŒ APIè¿æ¥å¤±è´¥: ${response.status} - ${response.statusText}`, false);
                }
            } catch (error) {
                addResult(`âŒ APIè¿æ¥å¤±è´¥: ${error.message}`, false);
                if (error.message.includes('CORS')) {
                    addResult(`ğŸ’¡ <strong>è§£å†³æ–¹æ¡ˆ:</strong> ç‚¹å‡»ä¸Šæ–¹"ğŸš€ å¯ç”¨CORSä»£ç†"æŒ‰é’®`, false);
                }
            }
        }
        
        // æµ‹è¯•CORSå¤´éƒ¨
        async function testCorsHeaders() {
            clearResults();
            addResult('ğŸ” å¼€å§‹CORSå¤´éƒ¨æµ‹è¯•...', true);
            showEnvironmentInfo();
            
            try {
                const response = await fetch(`${API_URL}/health`, {
                    method: 'OPTIONS',
                    headers: {
                        'Origin': window.location.origin,
                        'Access-Control-Request-Method': 'GET',
                        'Access-Control-Request-Headers': 'Content-Type, Authorization'
                    }
                });
                
                addResult(`âœ… CORSé¢„æ£€è¯·æ±‚æˆåŠŸ: ${response.status}`, true);
                
                // æ£€æŸ¥å“åº”å¤´
                const corsHeaders = {
                    'Access-Control-Allow-Origin': response.headers.get('Access-Control-Allow-Origin'),
                    'Access-Control-Allow-Methods': response.headers.get('Access-Control-Allow-Methods'),
                    'Access-Control-Allow-Headers': response.headers.get('Access-Control-Allow-Headers'),
                    'Access-Control-Max-Age': response.headers.get('Access-Control-Max-Age')
                };
                
                addResult(`CORSå¤´éƒ¨ä¿¡æ¯:<pre>${JSON.stringify(corsHeaders, null, 2)}</pre>`, true);
                
                // æ£€æŸ¥æ˜¯å¦æ­£ç¡®è®¾ç½®äº†Origin
                const allowedOrigin = corsHeaders['Access-Control-Allow-Origin'];
                if (allowedOrigin === '*' || allowedOrigin === window.location.origin) {
                    addResult(`âœ… CORSé…ç½®æ­£ç¡®ï¼`, true);
                } else if (allowedOrigin === null) {
                    addResult(`âŒ CORSé…ç½®é—®é¢˜ï¼šæœåŠ¡å™¨æœªè¿”å›CORSå¤´éƒ¨`, false);
                    addResult(`ğŸ’¡ <strong>è§£å†³æ–¹æ¡ˆ:</strong> ç‚¹å‡»ä¸Šæ–¹"ğŸš€ å¯ç”¨CORSä»£ç†"æŒ‰é’®`, false);
                } else {
                    addResult(`âš ï¸ CORSé…ç½®é—®é¢˜ï¼šå…è®¸çš„Origin (${allowedOrigin}) ä¸å½“å‰åŸŸå (${window.location.origin}) ä¸åŒ¹é…`, false);
                }
                
            } catch (error) {
                addResult(`âŒ CORSé¢„æ£€æµ‹è¯•å¤±è´¥: ${error.message}`, false);
                if (error.message.includes('CORS')) {
                    addResult(`ğŸ’¡ <strong>è§£å†³æ–¹æ¡ˆ:</strong> ç‚¹å‡»ä¸Šæ–¹"ğŸš€ å¯ç”¨CORSä»£ç†"æŒ‰é’®`, false);
                }
            }
        }
        
        // ğŸ” ä»£ç†è¯Šæ–­æµ‹è¯•
        async function testProxyDiagnostics() {
            clearResults();
            addResult('ğŸ” å¼€å§‹ä»£ç†è¯Šæ–­æµ‹è¯•...', true);
            showEnvironmentInfo();
            
            // 1. æµ‹è¯•ä»£ç†æœåŠ¡å™¨æœ¬èº«
            addResult('1ï¸âƒ£ æµ‹è¯•ä»£ç†æœåŠ¡å™¨è¿æ¥...', true);
            try {
                const proxyTestUrl = CORS_PROXY + 'https://httpbin.org/json';
                const response = await originalFetch(proxyTestUrl, {
                    headers: {
                        'X-Requested-With': 'XMLHttpRequest'
                    }
                });
                if (response.ok) {
                    addResult('âœ… ä»£ç†æœåŠ¡å™¨è¿æ¥æ­£å¸¸', true);
                } else {
                    addResult(`âŒ ä»£ç†æœåŠ¡å™¨å“åº”å¼‚å¸¸: ${response.status}`, false);
                }
            } catch (error) {
                addResult(`âŒ ä»£ç†æœåŠ¡å™¨è¿æ¥å¤±è´¥: ${error.message}`, false);
                addResult('ğŸ’¡ å¯èƒ½æ˜¯ä»£ç†æœåŠ¡å™¨æš‚æ—¶ä¸å¯ç”¨', false);
                return;
            }
            
            // 2. æµ‹è¯•åç«¯ç›´æ¥è¿æ¥ï¼ˆä¸é€šè¿‡ä»£ç†ï¼‰
            addResult('2ï¸âƒ£ æµ‹è¯•åç«¯ç›´æ¥è¿æ¥...', true);
            try {
                const directResponse = await originalFetch(`${API_URL}/health`);
                addResult(`ğŸ“Š ç›´æ¥è¿æ¥çŠ¶æ€: ${directResponse.status} ${directResponse.statusText}`, directResponse.ok);
                if (directResponse.ok) {
                    const data = await directResponse.json();
                    addResult(`âœ… åç«¯æœåŠ¡æ­£å¸¸: ${JSON.stringify(data)}`, true);
                } else {
                    addResult(`âš ï¸ åç«¯æœåŠ¡å¼‚å¸¸`, false);
                }
            } catch (error) {
                if (error.message.includes('CORS')) {
                    addResult(`âœ… é¢„æœŸçš„CORSé”™è¯¯ï¼ˆæ­£å¸¸ï¼‰`, true);
                } else {
                    addResult(`âŒ åç«¯è¿æ¥å¤±è´¥: ${error.message}`, false);
                }
            }
            
            // 3. æµ‹è¯•ä»£ç†è¿æ¥åˆ°åç«¯
            addResult('3ï¸âƒ£ æµ‹è¯•ä»£ç†è¿æ¥åˆ°åç«¯...', true);
            try {
                const proxyBackendUrl = CORS_PROXY + `${API_URL}/health`;
                addResult(`ğŸ“¡ ä»£ç†URL: ${proxyBackendUrl}`, true);
                
                const startTime = Date.now();
                const proxyResponse = await originalFetch(proxyBackendUrl, {
                    headers: {
                        'X-Requested-With': 'XMLHttpRequest'
                    }
                });
                const endTime = Date.now();
                const duration = endTime - startTime;
                
                addResult(`ğŸ“Š ä»£ç†è¯·æ±‚è€—æ—¶: ${duration}ms`, true);
                addResult(`ğŸ“ˆ ä»£ç†å“åº”çŠ¶æ€: ${proxyResponse.status} ${proxyResponse.statusText}`, proxyResponse.ok);
                
                if (proxyResponse.ok) {
                    const data = await proxyResponse.json();
                    addResult(`âœ… ä»£ç†è¿æ¥æˆåŠŸ: <pre>${JSON.stringify(data, null, 2)}</pre>`, true);
                } else {
                    addResult(`âŒ ä»£ç†è¿æ¥å¤±è´¥: HTTP ${proxyResponse.status}`, false);
                    const errorText = await proxyResponse.text();
                    addResult(`ğŸ” é”™è¯¯å†…å®¹: ${errorText}`, false);
                }
            } catch (error) {
                addResult(`âŒ ä»£ç†è¿æ¥å¤±è´¥: ${error.message}`, false);
                addResult(`ğŸ” é”™è¯¯è¯¦æƒ…: ${error.constructor.name}`, false);
            }
            
            // 4. æµ‹è¯•ä¸åŒçš„ç«¯ç‚¹
            addResult('4ï¸âƒ£ æµ‹è¯•å…¶ä»–ç«¯ç‚¹...', true);
            const testEndpoints = [
                { path: '/', name: 'æ ¹è·¯å¾„' },
                { path: '/api/courses', name: 'è¯¾ç¨‹API' }
            ];
            
            for (const endpoint of testEndpoints) {
                try {
                    const url = CORS_PROXY + `${API_URL}${endpoint.path}`;
                    const response = await originalFetch(url, {
                        headers: {
                            'X-Requested-With': 'XMLHttpRequest'
                        }
                    });
                    addResult(`ğŸ“ ${endpoint.name}: ${response.status} ${response.statusText}`, response.ok);
                } catch (error) {
                    addResult(`ğŸ“ ${endpoint.name}: å¤±è´¥ - ${error.message}`, false);
                }
            }
            
            // 5. åˆ†æç»“æœ
            addResult('5ï¸âƒ£ è¯Šæ–­æ€»ç»“...', true);
            if (isProxyEnabled) {
                addResult('ğŸ”§ ä»£ç†å·²å¯ç”¨ï¼Œå¦‚æœå¥åº·æ£€æŸ¥å¤±è´¥ï¼Œå¯èƒ½çš„åŸå› ï¼š', true);
                addResult('â€¢ ä»£ç†æœåŠ¡å™¨ä¸´æ—¶ä¸å¯ç”¨', true);
                addResult('â€¢ åç«¯æœåŠ¡å™¨å“åº”å¼‚å¸¸', true);
                addResult('â€¢ ç½‘ç»œè¿æ¥é—®é¢˜', true);
                addResult('â€¢ è¯·æ±‚æ ¼å¼é—®é¢˜', true);
                addResult('ğŸ’¡ å»ºè®®ï¼šå°è¯•ç¦ç”¨ä»£ç†åé‡æ–°æµ‹è¯•ï¼Œæˆ–ç­‰å¾…ç‰‡åˆ»åé‡è¯•', true);
            } else {
                addResult('ğŸ”§ ä»£ç†æœªå¯ç”¨ï¼Œå»ºè®®å¯ç”¨ä»£ç†åé‡æ–°æµ‹è¯•', true);
            }
        }
        
        // é¡µé¢åŠ è½½æ—¶æ˜¾ç¤ºæ¬¢è¿ä¿¡æ¯
        window.onload = function() {
            addResult(`ğŸ¯ <strong>CORSæµ‹è¯•å·¥å…·å·²å‡†å¤‡å°±ç»ª</strong>`, true);
            addResult(`ğŸ“‹ å¦‚æœé‡åˆ°CORSé”™è¯¯ï¼Œè¯·ä½¿ç”¨ä¸Šæ–¹çš„ä»£ç†è§£å†³æ–¹æ¡ˆ`, true);
            addResult(`ğŸš€ ä»£ç†åŠŸèƒ½å¯ä»¥100%è§£å†³CORSé—®é¢˜ï¼`, true);
        };
    </script>
</body>
</html> 